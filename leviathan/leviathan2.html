<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/over-the-wire/_next/static/css/86b7aba7af294b94.css" as="style"/><link rel="stylesheet" href="/over-the-wire/_next/static/css/86b7aba7af294b94.css" data-n-g=""/><link rel="preload" href="/over-the-wire/_next/static/css/2a97f9c7fde1f37f.css" as="style"/><link rel="stylesheet" href="/over-the-wire/_next/static/css/2a97f9c7fde1f37f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/over-the-wire/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/over-the-wire/_next/static/chunks/webpack-f6318ba5529f7f5c.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/framework-81da43a8dcd978d9.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/main-00ca3f3974f0a67a.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/pages/_app-4def5050ef33c1d2.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/369-eeb2b79f75cc27b6.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/pages/leviathan/leviathan2-8a287e00bf7c5623.js" defer=""></script><script src="/over-the-wire/_next/static/JcUVksAhJ9Snvllfe1ZDW/_buildManifest.js" defer=""></script><script src="/over-the-wire/_next/static/JcUVksAhJ9Snvllfe1ZDW/_ssgManifest.js" defer=""></script><script src="/over-the-wire/_next/static/JcUVksAhJ9Snvllfe1ZDW/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><nav class="Nav_navBar__ioQlk"><ul class="Nav_navItems__n_3aD"><li class="Nav_navLink__4k_2G"><a href="/over-the-wire">Home</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/bandit">Bandit</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/natas">Natas</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/leviathan">Leviathan</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/narnia">Narnia</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/cipher">Cipher</a></li></ul></nav><div class="MainContainer_mainContainer__0FIFy"><div><h1>Leviathan 2</h1><div class="Keyword_keyword__javqt"><p class="Keyword_keywordHead__40fuD">Keywords: </p><span class="Tag_tag__AJnTY">symlink</span></div><section><h2>Experience</h2><p>Greeted by another executable, this time called printfile. Running the program tells us that it will print the file we put as argument. However, as expected, it was not that simple, inserting the path to the leviathan3 password, i.e. /etc/leviathan_pass/leviathan3 returns the statement that we do not have access to that file. Now, using our trusty ltrace, we can see what the program is doing in the background. I also learnt about other ltrace flags, -f to trace processes if there is fork or clone and more interestingly -S to show system calls as well. These were not as useful for this exercise, but I read through the manual a bit to learn more about ltrace as it seems quite useful.</p><div class="BlogImage_imgContainer__s2tL6"><img src="/over-the-wire/images/leviathan2-1.png" alt="ltrace of printfile showing the call of library function, access" width="600"/></div><p>As shown in the image, it seems to be using a function called access to determine whether we are allowed to access the file. I then had a look at what it would do, if we do indeed have access to the file. So, create a temporary directory as directed by overthewire, and a file you have access to.</p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>mkdir /tmp/insertrandom523
<!-- --></span>echo test &gt; /tmp/insertrandom523/test.txt
<!-- -->./printfile /tmp/insertrandom523/test.txt<!-- --></code></pre></div><p>Using ltrace for this case, we obtain:</p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>__libc_start_main(0x804852b, 2, 0xffffd744, 0x8048610 &lt;unfinished ...&gt;
<!-- --></span>access(&quot;/tmp/insertrandom523/test.txt&quot;, 4)               = 0
<!-- -->snprintf(&quot;/bin/cat /tmp/insertrandom523/te&quot;..., 511, &quot;/bin/cat %s&quot;, &quot;/tmp/insertrandom523/test.txt&quot;) = 38
<!-- -->geteuid()                                                = 12002
<!-- -->geteuid()                                                = 12002
<!-- -->setreuid(12002, 12002)                                   = 0
<!-- -->system(&quot;/bin/cat /tmp/insertrandom523/te&quot;...test<!-- --></code></pre></div><p>Interestingly, access and the shell command would use different user ids. It appears that when using the <!-- --><code>system</code> function, it sets the real user id to the effetive user id. The effective user id is what is normally used to check whether we have access to a file or not, surprisingly we actually have a read access to the leviathan password file.<!-- --></p><div class="BlogImage_imgContainer__s2tL6"><img src="/over-the-wire/images/leviathan2-1.png" alt="read access is shown for users for all leviathan passwords" width="600"/></div><p>Therefore, at the system function call, the shell should have the permission to read from the leviathan passwords. I&#x27;m not sure why normally, you can&#x27;t access the passwords, as <!-- --><code>ls -la</code> showed read access, perhaps it does a separate checking which will not occur in this case. With that knowledge, we must bypass the <!-- --><code>access</code> function.<!-- --></p><p>This was quite difficult to do, however, looking at the trace, I noticed that the string used for <!-- --><code>access</code> and the string used by <!-- --><code>snprintf</code>is different. Namely that the string for <!-- --><code>access</code> have a double quote for the entire argument that was given to the program, however for the <!-- --><code>snprintf</code>, it appears that the double quote has been trimmed. That is, instead of:<!-- --></p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>&quot;/bin/cat \&quot;/tmp/insertrandom523/...\&quot;&quot;<!-- --></span></code></pre></div><p>It is instead:</p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>&quot;/bin/cat /tmp/insertrandom523/...&quot;<!-- --></span></code></pre></div><p>More research led me to learning about symbolic links. With all these information, we could combine and solve this challenge. First create a file with a space in its name, this would allow it to be interpreted as two separate files by <!-- --><code>cat</code> due to the trimming of the double quote. So e.g.<!-- --></p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>echo &gt; a\ test.txt<!-- --></span></code></pre></div><p>Then, write a symbolic link with the name of the first part of that file to the leviathan password file.</p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>ln -s /etc/leviathan_pass/leviathan3 a<!-- --></span></code></pre></div><p>Then we simply run <!-- --><code>printfile</code> on the file we have access to (the non symbolic link file). This would give us the key to Leviathan 3<!-- --></p></section><section><h2>Reflection</h2></section><section><h2>Key</h2><div class="SpoilerKey_codeBlock__KWl0d"><div class="SpoilerKey_spoilerToggler__HCeWZ"><button>Click to Reveal</button></div><div class="SpoilerKey_spoilerContainer__O76It"><div class="SpoilerKey_spoiler__YWx_s "><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>Ahdiemoo1j<!-- --></span></code></pre></div></div></div></section><div class="PageNav_pageNav__NXqbT"><div><a title="Previous page" class="PageNav_navButton__yHhmO" href="/over-the-wire/leviathan/leviathan1">◀</a></div><div><a title="Next page" class="PageNav_navButton__yHhmO" href="/over-the-wire/leviathan/leviathan3">▶</a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/leviathan/leviathan2","query":{},"buildId":"JcUVksAhJ9Snvllfe1ZDW","assetPrefix":"/over-the-wire","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>