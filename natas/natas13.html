<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/over-the-wire/_next/static/css/86b7aba7af294b94.css" as="style"/><link rel="stylesheet" href="/over-the-wire/_next/static/css/86b7aba7af294b94.css" data-n-g=""/><link rel="preload" href="/over-the-wire/_next/static/css/dab4cb06b756ec9e.css" as="style"/><link rel="stylesheet" href="/over-the-wire/_next/static/css/dab4cb06b756ec9e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/over-the-wire/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/over-the-wire/_next/static/chunks/webpack-f6318ba5529f7f5c.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/framework-81da43a8dcd978d9.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/main-00ca3f3974f0a67a.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/pages/_app-4def5050ef33c1d2.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/369-eeb2b79f75cc27b6.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/pages/natas/natas13-dbc71283b8cec97e.js" defer=""></script><script src="/over-the-wire/_next/static/4Ji0R6oAyFwF_27HCAkm4/_buildManifest.js" defer=""></script><script src="/over-the-wire/_next/static/4Ji0R6oAyFwF_27HCAkm4/_ssgManifest.js" defer=""></script><script src="/over-the-wire/_next/static/4Ji0R6oAyFwF_27HCAkm4/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><nav class="Nav_navBar__ioQlk"><ul class="Nav_navItems__n_3aD"><li class="Nav_navLink__4k_2G"><a href="/over-the-wire">Home</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/bandit">Bandit</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/natas">Natas</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/leviathan">Leviathan</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/narnia">Narnia</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/cipher">Cipher</a></li></ul></nav><div class="MainContainer_mainContainer__0FIFy"><div><h1>Natas 13</h1><div class="Keyword_keyword__javqt"><p class="Keyword_keywordHead__40fuD">Keywords: </p><span class="Tag_tag__AJnTY">file-upload</span><span class="Tag_tag__AJnTY">documentation</span><span class="Tag_tag__AJnTY">magic-number</span></div><section><h2>Experience</h2><p>This is quite similar to the previous level, with the main difference being that it&#x27;s supposed to check what type of file has been uploaded. So the main question I asked was, how would it know?</p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-php" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#f8f8f2">}<!-- --></span><span> <!-- --></span><span class="token" style="color:#8be9fd">else<!-- --></span><span> <!-- --></span><span class="token" style="color:#8be9fd">if<!-- --></span><span> <!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token" style="color:#f8f8f2">!<!-- --></span><span> <!-- --></span><span class="token" style="color:#f1fa8c">exif_imagetype<!-- --></span><span class="token" style="color:#f8f8f2">(<!-- --></span><span class="token global">$_FILES<!-- --></span><span class="token" style="color:#f8f8f2">[<!-- --></span><span class="token single-quoted-string" style="color:#50fa7b">&#x27;uploadedfile&#x27;<!-- --></span><span class="token" style="color:#f8f8f2">]<!-- --></span><span class="token" style="color:#f8f8f2">[<!-- --></span><span class="token single-quoted-string" style="color:#50fa7b">&#x27;tmp_name&#x27;<!-- --></span><span class="token" style="color:#f8f8f2">]<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span class="token" style="color:#f8f8f2">)<!-- --></span><span> <!-- --></span><span class="token" style="color:#f8f8f2">{<!-- --></span><span>
<!-- --></span><span>        <!-- --></span><span class="token" style="color:#8be9fd">echo<!-- --></span><span> <!-- --></span><span class="token double-quoted-string" style="color:#50fa7b">&quot;File is not an image&quot;<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span></code></pre></div><p>the above code is a snippet of the source code available and it shows the usage of <!-- --><code>exif_imagetypes</code>. Reading the <!-- --><a href="https://www.php.net/manual/en/function.exif-imagetype.php">php manual</a> regarding this function, it appears to simply check the first couple of bytes, that is the <!-- --><em>magic number</em> of the file. Magic numbers are essentially unique signatures that indicates what type a file is. This is not meant to be used for thorough checking of the actual type of file. This mirrors how may mistakenly think a <!-- --><code>robots.txt</code> will prevent web crawlers from accessing a page, when in reality, they are there as standards which malicious attackers do not need to follow.<!-- --></p><p>Simple enough, I used the same file as before, however I added the appropriate .jpg magic numbers to the start of the file, that is <!-- --><code>FF D8 FF</code>. To do so, I used the program <!-- --><a href="https://mh-nexus.de/en/hxd/">HxD</a> which allowed me to modify the code&#x27;s hex representation. To add bytes to the file using HxD, we need to be on insert mode, otherwise, it will only rewrite existing bytes.<!-- --></p><p>The rest of the procedure is the same as with Natas 12, select the php file to upload, change the extension using developer tools, upload, then go to the url.</p></section><section><h2>Reflection</h2><p>This is perhaps a common mistake new developers may employ to prevent full unrestricted file uploads. One could imagine that without a good knowledge of how <!-- --><code>exif_imagetypes</code> actually checks the file type, a developer may think it is an already implemented function that can check thoroughly the type of file uploaded. When instead, it relies on a easy to replicate meta data header in the form of some magic numbers. This again emphasise the importance of knowing how functions we call work especially when handling potentially security risking areas of a program. The documentation would have been clear that it does not thoroughly check the whole file, only the first couple of bytes.<!-- --></p><p>I could also take this as an indicator that teaching common vulnerabilities to junior developers should be a major priority especially if they are writing programs that interface with users. An important distionction must also be made about what type of things are standard but not necessarily true, e.g. that the magic number will match the actual type of the file.</p></section><section><h2>Key</h2><div class="SpoilerKey_codeBlock__KWl0d"><div class="SpoilerKey_spoilerToggler__HCeWZ"><button>Click to Reveal</button></div><div class="SpoilerKey_spoilerContainer__O76It"><div class="SpoilerKey_spoiler__YWx_s "><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>Lg96M10TdfaPyVBkJdjymbllQ5L6qdl1<!-- --></span></code></pre></div></div></div></section><div class="PageNav_pageNav__NXqbT"><div><a title="Previous page" class="PageNav_navButton__yHhmO" href="natas12">◀</a></div><div><a title="Next page" class="PageNav_navButton__yHhmO" href="natas14">▶</a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/natas/natas13","query":{},"buildId":"4Ji0R6oAyFwF_27HCAkm4","assetPrefix":"/over-the-wire","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>