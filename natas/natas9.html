<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/over-the-wire/_next/static/css/86b7aba7af294b94.css" as="style"/><link rel="stylesheet" href="/over-the-wire/_next/static/css/86b7aba7af294b94.css" data-n-g=""/><link rel="preload" href="/over-the-wire/_next/static/css/dab4cb06b756ec9e.css" as="style"/><link rel="stylesheet" href="/over-the-wire/_next/static/css/dab4cb06b756ec9e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/over-the-wire/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/over-the-wire/_next/static/chunks/webpack-f6318ba5529f7f5c.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/framework-81da43a8dcd978d9.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/main-00ca3f3974f0a67a.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/pages/_app-4def5050ef33c1d2.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/369-eeb2b79f75cc27b6.js" defer=""></script><script src="/over-the-wire/_next/static/chunks/pages/natas/natas9-27a278a827c41e8c.js" defer=""></script><script src="/over-the-wire/_next/static/zGN-9lG5ZvI19uo1bVXal/_buildManifest.js" defer=""></script><script src="/over-the-wire/_next/static/zGN-9lG5ZvI19uo1bVXal/_ssgManifest.js" defer=""></script><script src="/over-the-wire/_next/static/zGN-9lG5ZvI19uo1bVXal/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><nav class="Nav_navBar__ioQlk"><ul class="Nav_navItems__n_3aD"><li class="Nav_navLink__4k_2G"><a href="/over-the-wire">Home</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/bandit">Bandit</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/natas">Natas</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/leviathan">Leviathan</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/narnia">Narnia</a></li><li class="Nav_navLink__4k_2G"><a href="/over-the-wire/cipher">Cipher</a></li></ul></nav><div class="MainContainer_mainContainer__0FIFy"><div><h1>Natas 9</h1><div class="Keyword_keyword__javqt"><p class="Keyword_keywordHead__40fuD">Keywords: </p><span class="Tag_tag__AJnTY">php</span><span class="Tag_tag__AJnTY">documentation</span><span class="Tag_tag__AJnTY">mixing-input-and-controls</span><span class="Tag_tag__AJnTY">input-sanitisation</span><span class="Tag_tag__AJnTY">owasp</span></div><section><h2>Experience</h2><p>Jumping right to it, this seems like another challenge to find the right query to get the passwords stored somewhere in the server. The main logic of the search function can be seen below:</p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-php" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token php language-php delimiter" style="color:#ffb86c;font-weight:bold">&lt;?<!-- --></span><span class="token php language-php">
<!-- --></span><span class="token php language-php"></span><span class="token php language-php" style="color:#f8f8f2">$key<!-- --></span><span class="token php language-php"> <!-- --></span><span class="token php language-php" style="color:#f8f8f2">=<!-- --></span><span class="token php language-php"> <!-- --></span><span class="token php language-php double-quoted-string" style="color:#50fa7b">&quot;&quot;<!-- --></span><span class="token php language-php" style="color:#f8f8f2">;<!-- --></span><span class="token php language-php">
<!-- --></span><span class="token php language-php">
<!-- --></span><span class="token php language-php"></span><span class="token php language-php" style="color:#8be9fd">if<!-- --></span><span class="token php language-php" style="color:#f8f8f2">(<!-- --></span><span class="token php language-php" style="color:#f1fa8c">array_key_exists<!-- --></span><span class="token php language-php" style="color:#f8f8f2">(<!-- --></span><span class="token php language-php double-quoted-string" style="color:#50fa7b">&quot;needle&quot;<!-- --></span><span class="token php language-php" style="color:#f8f8f2">,<!-- --></span><span class="token php language-php"> <!-- --></span><span class="token php language-php global">$_REQUEST<!-- --></span><span class="token php language-php" style="color:#f8f8f2">)<!-- --></span><span class="token php language-php" style="color:#f8f8f2">)<!-- --></span><span class="token php language-php"> <!-- --></span><span class="token php language-php" style="color:#f8f8f2">{<!-- --></span><span class="token php language-php">
<!-- --></span><span class="token php language-php">    <!-- --></span><span class="token php language-php" style="color:#f8f8f2">$key<!-- --></span><span class="token php language-php"> <!-- --></span><span class="token php language-php" style="color:#f8f8f2">=<!-- --></span><span class="token php language-php"> <!-- --></span><span class="token php language-php global">$_REQUEST<!-- --></span><span class="token php language-php" style="color:#f8f8f2">[<!-- --></span><span class="token php language-php double-quoted-string" style="color:#50fa7b">&quot;needle&quot;<!-- --></span><span class="token php language-php" style="color:#f8f8f2">]<!-- --></span><span class="token php language-php" style="color:#f8f8f2">;<!-- --></span><span class="token php language-php">
<!-- --></span><span class="token php language-php"></span><span class="token php language-php" style="color:#f8f8f2">}<!-- --></span><span class="token php language-php">
<!-- --></span><span class="token php language-php">
<!-- --></span><span class="token php language-php"></span><span class="token php language-php" style="color:#8be9fd">if<!-- --></span><span class="token php language-php" style="color:#f8f8f2">(<!-- --></span><span class="token php language-php" style="color:#f8f8f2">$key<!-- --></span><span class="token php language-php"> <!-- --></span><span class="token php language-php" style="color:#f8f8f2">!=<!-- --></span><span class="token php language-php"> <!-- --></span><span class="token php language-php double-quoted-string" style="color:#50fa7b">&quot;&quot;<!-- --></span><span class="token php language-php" style="color:#f8f8f2">)<!-- --></span><span class="token php language-php"> <!-- --></span><span class="token php language-php" style="color:#f8f8f2">{<!-- --></span><span class="token php language-php">
<!-- --></span><span class="token php language-php">    <!-- --></span><span class="token php language-php" style="color:#f1fa8c">passthru<!-- --></span><span class="token php language-php" style="color:#f8f8f2">(<!-- --></span><span class="token php language-php double-quoted-string" style="color:#50fa7b">&quot;grep -i <!-- --></span><span class="token php language-php double-quoted-string interpolation" style="color:#50fa7b">$key<!-- --></span><span class="token php language-php double-quoted-string" style="color:#50fa7b"> dictionary.txt&quot;<!-- --></span><span class="token php language-php" style="color:#f8f8f2">)<!-- --></span><span class="token php language-php" style="color:#f8f8f2">;<!-- --></span><span class="token php language-php">
<!-- --></span><span class="token php language-php"></span><span class="token php language-php" style="color:#f8f8f2">}<!-- --></span><span class="token php language-php">
<!-- --></span><span class="token php language-php"></span><span class="token php language-php delimiter" style="color:#ffb86c;font-weight:bold">?&gt;<!-- --></span></code></pre></div><p>If any none empty string is inserted in the input box, it will run a grep command which appears to find that word from a dictionary.txt file. My understanding of grep is quite limited, although, I do know that it is a shell command. Looking up what &quot;passthru&quot; does, it confirmed my suspicion that it is running a shell command. This as one might expect is not very secure.</p><p>I&#x27;m sure that it is possible to use grep somehow, but what I did was to simply use a semicolon which marks the end of the shell statement, then, use the <!-- --><code>cat</code> command instead which will read out the content of a file we specified. We already know that the password is located at <!-- --><code>/etc/natas_webpass/natas10</code> and so we simply specify that for <!-- --><code>cat</code>.<!-- --></p><div class="CodeBlock_CodeBlock___IBBd"><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-shell" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#f8f8f2">;<!-- --></span><span class="token" style="color:#f1fa8c">cat<!-- --></span><span> /etc/natas_webpass/natas10<!-- --></span><span class="token" style="color:#f8f8f2">;<!-- --></span></code></pre></div><p>Inserting another semicolon at the end, it ensures that at least the cat command is correct. Just like that, I was able to obtain the flag.</p></section><section><h2>Research</h2><p>Looking at the <!-- --><a href="https://www.php.net/manual/en/function.passthru.php">php manual</a> <!-- -->for passthru, under the notes it clearly warns of &quot;user-supplied data&quot; which this is an example of. The main problem with this site is that user inputs are mixed with controls without the inputs being properly sanitised. As the manual suggested, <!-- --><code>escapeshellarg()</code> should have been used in this case instead. This function would ensure that the input only act as an argument of the shell command.<!-- --></p><p>What is input sanitisation specifically? Input sanitisation really refers to cleaning user inputs, checking that it is in an acceptable format. There are multiple ways to do this, as stated in <!-- --><a href="https://www.webopedia.com/definitions/input-sanitization/">webopedia</a>, most importantly whitelisting and blacklisting.<!-- --></p><p>Whitelisting involves ensuring that user inputs are limited to things that matches the whitelist, on a character by character basis or on a whole string basis, or template basis, etc. Whitelisting might be difficult to implement, especially in a system which should allow a range of user input. If too little are whitelisted, the system might be rigid and frustrating for users to use, too much, then it might allow for some forms of insecure inputs.</p><p>Blacklisting is quite similar, but it looks at things from the opposite site, if things matches what is on the blacklist, it removes them, this is often problematic as there might be a large set of strings that must be removed, or the method of removal itself may be vulnerable. If the checking is linear, an attacker may put blacklisted strings between what they actually intent on typing, e.g. if &#x27;WORD&#x27; is blacklisted, the user could input &#x27;WO<!-- --><i>WORD</i>RD&#x27;, and it would result in them successfully going around the blacklist. Another problem is that, blacklisted words may also be valid inputs, for example &quot;and&quot; or single quote in a name like Brian O&#x27;Connor.<!-- --></p><p>Another interesting example where blacklisting might fail is with unicode or other encoding. <!-- --><a href="https://owasp.org/www-community/attacks/Unicode_Encoding">Owasp</a> details a potential attack using unicode encoding. The scenario detailed is of one for path traversal attack, if the system blacklisted &quot;../&quot; only, it will be vulnerable to attackers using the equivalent unicode &quot;%C0AE%C0AE%C0AF%&quot;. Owasp is a good website to look at common types of attacks. Another potential reading are <!-- --><a href="https://www.sciencedirect.com/topics/computer-science/input-validation">Science Direct articles on input validation</a>.<!-- --></p></section><section><h2>Reflection</h2><p>When writing quick programs, it is often difficult to make oneself read a whole documentation of a small function before use, however, this whole level really demonstrated how this could be a potential source of exploitation. It seems that especially in terms of taking inputs from users, it is essential to always see whether the functions used are safe. This also show the need for testing in terms of user inputs, not only of edge cases, but also potentially dangerous inputs.</p><p>Relating to checking if the functions used to process user inputs are safe, is to validate user inputs themselves through whitelisting and blacklisting. Further it is essential to use already created libraries/functions that are trusted and secure to process user inputs. As I notice during research about whitelisting and blacklisting, it can be very difficult to write a proper list, especially considering different types of encoding such as for unicode.</p></section><section><h2>Key</h2><div class="SpoilerKey_codeBlock__KWl0d"><div class="SpoilerKey_spoilerToggler__HCeWZ"><button>Click to Reveal</button></div><div class="SpoilerKey_spoilerContainer__O76It"><div class="SpoilerKey_spoiler__YWx_s "><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>nOpp1igQAkUzaI1GUUjzn1bFVj7xCNzu<!-- --></span></code></pre></div></div></div></section><div class="PageNav_pageNav__NXqbT"><div><a title="Previous page" class="PageNav_navButton__yHhmO" href="/over-the-wire/natas/natas8">◀</a></div><div><a title="Next page" class="PageNav_navButton__yHhmO" href="/over-the-wire/natas/natas10">▶</a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/natas/natas9","query":{},"buildId":"zGN-9lG5ZvI19uo1bVXal","assetPrefix":"/over-the-wire","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>